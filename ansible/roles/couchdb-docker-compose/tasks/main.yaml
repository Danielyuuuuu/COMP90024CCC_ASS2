# - name: Remove docker
#   become: yes
#   shell: sudo apt-get remove docker docker-engine docker.io containerd runc
# - name: Install docker
#   shell: |
#     sudo apt-get install \
#     apt-transport-https \
#     ca-certificates \
#     curl \
#     gnupg \
#     lsb-release

# - name: Install apt transport https
#   shell: sudo apt install apt-transport-https ca-certificates curl software-properties-common

# - name: Add GPG key
#   shell: curl -fsSL https://download.docker.com/linux/ubuntu/gpg | sudo apt-key add -

# - name: Add the Docker repository to APT sources
#   shell: sudo add-apt-repository "deb [arch=amd64] https://download.docker.com/linux/ubuntu focal stable"

- name: Install docker
  become: yes
  apt:
    name: ['docker.io']
    state: latest

- name: Install docker-compose
  become: yes
  apt:
    name: ['docker-compose']
    state: latest

- name: Remove previous PID file
  become: yes
  shell: rm -rf /var/run/docker.pid

- name:
  become: yes
  shell: ps axf | grep docker | grep -v grep | awk '{print "kill -9 " $1}' | sudo sh 

- name: Stop docker
  become: yes
  shell: sudo systemctl stop docker

- name: Start docker
  become: yes
  shell: sudo systemctl start docker

# - name: Start docker
#   become: yes
#   shell: |
#     sudo dockerd --debug \
#     --tls=true \
#     --tlscert=/var/docker/server.pem \
#     --tlskey=/var/docker/serverkey.pem \
#     --host tcp://192.168.59.3:2376

- name: Add user to docker group
  become: yes
  shell: sudo usermod -aG docker root

- name: Run couchDB docker compose
  become: yes
  shell: |
    chdir=/home/ubuntu/COMPCOMP90024CCC_ASS2/webdocker/
    sudo docker-compose up -d